!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Patrun=n()}}((function(){var n={exports:{}};function e(e){e=e||{};var t={},r={};function o(n,e,t){if(t){var r=n.g=n.g||{},o=r[e]=r[e]||[];o.push(t),o.sort((function(n,e){return n.val$<e.val$}))}}return t.top=function(){return r},t.add=function(u,i){u={...u};var f="function"==typeof e?e.call(t,u,i):null,l=Object.keys(u),s=[],c=[];l.forEach((function(n){var t=u[n];null!=t&&(t=String(t),u[n]=t,(e.gex&&t.match(/[*?]/)?c:s).push(n))})),s=s.sort(),c=c.sort(),l=s.concat(c);for(var a,v=r,d=0;d<l.length;d++){var p=l[d],g=u[p],h=e.gex&&g.match(/[*?]/)?n(g):null;h&&(h.val$=g);var k=(h?"1":"0")+"~"+p;if((a=v.v)&&k==v.sk)o(v,p,h),v=a[g]||(a[g]={});else if(v.k)if(k<v.sk){var y=v.s,x=v.g;v.s={k:v.k,sk:v.sk,v:v.v},y&&(v.s.s=y),x&&(v.s.g=x),v.g&&(v.g={}),o(v,p,h),v.k=p,v.sk=k,v.v={},v=v.v[g]={}}else a=v.v,v=v.s||(v.s={}),d--;else o(v,p,h),v.k=p,v.sk=k,v.v={},v=v.v[g]={}}return void 0!==i&&v&&(v.d=i,f&&(v.f="function"==typeof f?f:f.find,v.r="function"==typeof f.remove?f.remove:void 0)),t},t.findexact=function(n){return t.find(n,!0)},t.find=function(n,o,u){if(null==n)return null;var i=r,f=void 0===r.d?null:r.d,l=r.f,s=null,c=[],a={},v=Object.keys(n).length,d=[];void 0!==r.d&&d.push(r.d);do{if(s=i.k,i.v){var p=n[s],g=i.v[p];if(!g&&e.gex&&i.g&&i.g[s])for(var h=i.g[s],k=0;k<h.length;k++)if(null!=h[k].on(p)){g=i.v[h[k].val$];break}g?(a[s]=!0,i.s&&c.push(i.s),f=void 0===g.d?o?null:f:g.d,u&&void 0!==g.d&&d.push(g.d),l=g.f,i=g):i=i.s}else i=null;null==i&&0<c.length&&(null==f||u&&!o)&&(i=c.pop())}while(i);return o?Object.keys(a).length!==v&&(f=null):null==f&&void 0!==r.d&&(f=r.d),l&&(f=l.call(t,n,f)),u?d:f},t.remove=function(n){var e,t=r,o=null,u=[];do{if(e=t.k,t.v){var i=t.v[n[e]];i?(u.push({km:t,v:n[e]}),o=i.d,t=i):t=t.s}else t=null}while(t);if(void 0!==o){var f=u[u.length-1];if(f&&f.km&&f.km.v){var l=f.km.v[f.v];l.r&&!l.r(n,l.d)||delete l.d}}},t.list=function(e,t){e=e||{};var o=[];return r.d&&o.push({match:{},data:r.d,find:r.f}),function r(o,u,i,f){if(o.v){var l,s=o.k,c=n(e?null==e[s]?t?null:"*":e[s]:"*"),a={...u},v={...i};for(var d in o.v)if(d===e[s]||!t&&null==e[s]||c.on(d)){var p={...a};p[s]=d;var g={...v};delete g[s],l=o.v[d],0===Object.keys(g).length&&l&&l.d&&f.push({match:p,data:l.d,find:l.f}),l&&null!=l.v&&r(l,{...p},{...g},f)}(l=o.s)&&r(l,{...a},{...v},f)}}(r,{},{...e},o),o},t.toString=function(n,e){var t=!0===n||!!e,o="function"==typeof n?n:function(n){return"function"==typeof n?"<"+n.name+">":"<"+n+">"};function u(n,e){for(var t=0;t<e;t++)n.push(" ")}var i=[],f=[];return function n(e,t,r,f){var l;if(void 0!==e.d&&(t.push(" "+o(e.d)),i.push(f.join(", ")+" -> "+o(e.d))),e.k&&(t.push("\n"),u(t,r),t.push(e.k+":")),e.v){r++;var s=Object.keys(e.v),c=s.filter((function(n){return!n.match(/[*?]/)})),a=s.filter((function(n){return n.match(/[*?]/)}));c.sort(),a.sort(),s=c.concat(a);for(var v=0;v<s.length;v++){var d=s[v];t.push("\n"),u(t,r),t.push(d+" ->"),(l=f.slice()).push(e.k+"="+d),n(e.v[d],t,r+1,l)}e.s&&(t.push("\n"),u(t,r),t.push("|"),l=f.slice(),n(e.s,t,r+1,l))}}(r,f,0,[]),t?f.join(""):i.join("\n")},t.inspect=t.toString,t.toJSON=function(n){return JSON.stringify(r,(function(n,e){return"function"==typeof e?"[Function]":e}),n)},t}(function(){"use strict";var e=this,t=e.gex;function r(n){var r=this;function o(n){return null==n||null==n||Number.isNaN(n)}function u(n){var e=""+n;return o(n)&&(e=""),e}function i(n){n=""+n;for(var e=!1,t=Object.keys(s),r=0;r<t.length&&!e;r++)e=!!s[t[r]].exec(n);return e}r.noConflict=function(){return e.gex=t,r},r.on=function(n){var e=typeof n;if("string"===e||"number"===e||"boolean"===e||n instanceof Date||n instanceof RegExp)return i(n)?n:null;if(Array.isArray(n)){for(var t=[],r=0;r<n.length;r++)!o(n[r])&&i(n[r])&&t.push(n[r]);return t}if("object"===e){var u={};for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&i(f)&&(u[f]=n[f]);return u}return null},r.esc=function(n){var e=u(n);return(e=e.replace(/\*/g,"**")).replace(/\?/g,"*?")},r.re=function(n){if(""===n||n)return n="^"+(n=(n=(n=(n=(n=r.escregexp(n)).replace(/\\\*/g,"[\\s\\S]*")).replace(/\\\?/g,"[\\s\\S]")).replace(/\[\\s\\S\]\*\[\\s\\S\]\*/g,"\\*")).replace(/\[\\s\\S\]\*\[\\s\\S\]/g,"\\?"))+"$",new RegExp(n);var e=Object.keys(s);return 1==e.length?s[e[0]]:{...s}},r.escregexp=function(n){return n?(""+n).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},r.toString=function(){return f||(f="gex["+Object.keys(s)+"]")},r.inspect=function(){return r.toString()};var f,l=Array.isArray(n)?n:[n],s={};l.forEach((function(n){n=u(n);var e=r.re(n);s[n]=e}))}function o(n){return new r(n)}o.Gex=r,void 0!==n.exports?(n.exports&&(n.exports=n.exports=o),n.exports.gex=o):e.gex=o}).call(this),n=n.exports;return function(n){return new e(n)}}));